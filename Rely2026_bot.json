{
  "name": "Rely2026_bot",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "*"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -592,
        544
      ],
      "id": "721b4555-e3c2-45d7-bf25-dcc9313ce4d0",
      "name": "Telegram Trigger",
      "webhookId": "a3ebfa6b-5d56-49d5-8127-58bd3d680cc2",
      "credentials": {
        "telegramApi": {
          "id": "oGj8NtxFNeMajAXW",
          "name": "@Rely2026_bot"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# items ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è n8n, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ item'—ã\n\nphoto_list = []\n\n# –ø—Ä–æ—Å—Ç–æ–π —Å—á—ë—Ç—á–∏–∫ id_fotos\ncurrent_id = 1\n\nfor it in items:\n    foto = dict(it[\"json\"]) if \"json\" in it else {}\n\n    # –¥–æ–±–∞–≤–ª—è–µ–º id_fotos\n    foto[\"id_fotos\"] = current_id\n    current_id += 1\n\n    photo_list.append(foto)\n\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç:\nreturn [\n    {\n        \"json\": {\n            \"fotos\": photo_list\n        }\n    }\n]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        432
      ],
      "id": "4b682303-2636-41fd-89e3-b7553568e215",
      "name": "Code in Python (Beta)"
    },
    {
      "parameters": {
        "amount": "=5"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        352,
        128
      ],
      "id": "ae6b4946-7c61-478b-8b55-c4b3c636d3bc",
      "name": "Wait1",
      "webhookId": "1d9de6bf-7090-43ef-9945-71424eef35eb"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import re\n\n# –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥—è—â–∏–π item –∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º caption\nitems_in = items\ncaption = (items_in[0].get(\"json\", {}).get(\"caption\") or \"\").strip()\n\nLETTER_ORDER = [\"XXS\", \"XS\", \"S\", \"M\", \"L\", \"XL\", \"XXL\"]\n\n# –ë–∞–∑–æ–≤—ã–µ —Ü–≤–µ—Ç–∞ (RU/EN) + —Ç–∏–ø—ã/–º–∞—Ç–µ—Ä–∏–∞–ª—ã\nCOLOUR_KEYWORDS = [\n    # —Ä—É—Å—Å–∫–∏–µ —Ü–≤–µ—Ç–∞\n    \"—á–µ—Ä–Ω—ã–π\", \"—á—ë—Ä–Ω—ã–π\", \"—á–µ—Ä–Ω–∞—è\", \"—á—ë—Ä–Ω–∞—è\", \"—á–µ—Ä–Ω–æ–µ\", \"—á—ë—Ä–Ω–æ–µ\",\n    \"–±–µ–ª—ã–π\", \"–±–µ–ª–∞—è\", \"–±–µ–ª–æ–µ\",\n    \"—Å–µ—Ä—ã–π\", \"—Å–µ—Ä–∞—è\", \"—Å–µ—Ä–æ–µ\",\n    \"–∫—Ä–µ–º–æ–≤—ã–π\", \"–∫—Ä–µ–º–æ–≤–∞—è\", \"–∫—Ä–µ–º–æ–≤–æ–µ\",\n    \"–º–æ–ª–æ—á–Ω—ã–π\", \"–º–æ–ª–æ—á–Ω–∞—è\", \"–º–æ–ª–æ—á–Ω–æ–µ\",\n    \"–±–µ–∂–µ–≤—ã–π\", \"–±–µ–∂–µ–≤–∞—è\", \"–±–µ–∂–µ–≤–æ–µ\",\n    \"–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π\", \"–∫–æ—Ä–∏—á–Ω–µ–≤–∞—è\", \"–∫–æ—Ä–∏—á–Ω–µ–≤–æ–µ\",\n    \"–∫–∞—Ä–∞–º–µ–ª—å–Ω—ã–π\", \"–∫–∞—Ä–∞–º–µ–ª—å–Ω–∞—è\",\n    \"—Ä—ã–∂–∏–π\", \"—Ä—ã–∂–∞—è\",\n    \"–∑–æ–ª–æ—Ç–æ–π\", \"–∑–æ–ª–æ—Ç–∞—è\",\n    \"—Å–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π\", \"—Å–µ—Ä–µ–±—Ä–∏—Å—Ç–∞—è\",\n    \"–∫—Ä–∞—Å–Ω—ã–π\", \"–∫—Ä–∞—Å–Ω–∞—è\",\n    \"–±–æ—Ä–¥–æ–≤—ã–π\", \"–≤–∏–Ω–Ω—ã–π\",\n    \"—Ä–æ–∑–æ–≤—ã–π\", \"—Ä–æ–∑–æ–≤–∞—è\",\n    \"–æ—Ä–∞–Ω–∂–µ–≤—ã–π\", \"–æ—Ä–∞–Ω–∂–µ–≤–∞—è\",\n    \"–∂–µ–ª—Ç—ã–π\", \"–∂–µ–ª—Ç–∞—è\", \"–∂—ë–ª—Ç—ã–π\", \"–∂—ë–ª—Ç–∞—è\",\n    \"–∑–µ–ª–µ–Ω—ã–π\", \"–∑–µ–ª—ë–Ω—ã–π\", \"–∑–µ–ª–µ–Ω–∞—è\", \"–∑–µ–ª—ë–Ω–∞—è\",\n    \"—Ö–∞–∫–∏\",\n    \"–≥–æ–ª—É–±–æ–π\", \"–≥–æ–ª—É–±–∞—è\",\n    \"—Å–∏–Ω–∏–π\", \"—Å–∏–Ω—è—è\",\n    \"—Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π\", \"—Ç—ë–º–Ω–æ-—Å–∏–Ω–∏–π\",\n    \"–±–∏—Ä—é–∑–æ–≤—ã–π\",\n    \"—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π\", \"–ª–∞–≤–∞–Ω–¥–æ–≤—ã–π\",\n    \"—Å–µ—Ä–æ-–±–µ–∂–µ–≤—ã–π\", \"—Å–µ—Ä–æ –±–µ–∂–µ–≤—ã–π\",\n    # english\n    \"black\", \"white\", \"grey\", \"gray\", \"beige\", \"brown\",\n    \"camel\", \"ivory\", \"cream\", \"milk\", \"red\", \"wine\",\n    \"burgundy\", \"pink\", \"orange\", \"yellow\", \"green\",\n    \"khaki\", \"blue\", \"navy\", \"sky blue\", \"turquoise\",\n    \"purple\", \"lavender\", \"gold\", \"silver\",\n]\n\nTYPE_KEYWORDS = [\n    # –º–∞—Ç–µ—Ä–∏–∞–ª—ã / —Ç–∏–ø—ã RU\n    \"–∫–æ–∂–∞–Ω—ã–π\", \"–∫–æ–∂–∞–Ω–∞—è\", \"–∫–æ–∂–∞–Ω–æ–µ\", \"–∫–æ–∂–∞\",\n    \"—ç–∫–æ-–∫–æ–∂–∞\", \"—ç–∫–æ–∫–æ–∂–∞\", \"–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∫–æ–∂–∞\",\n    \"–∑–∞–º—à–µ–≤—ã–π\", \"–∑–∞–º—à–µ–≤–∞—è\", \"–∑–∞–º—à–∞\",\n    \"–±–∞—Ä—Ö–∞—Ç–Ω—ã–π\", \"–±–∞—Ä—Ö–∞—Ç–Ω–∞—è\", \"–±–∞—Ä—Ö–∞—Ç\",\n    \"–¥–∂–∏–Ω—Å–æ–≤—ã–π\", \"–¥–∂–∏–Ω—Å–æ–≤–∞—è\", \"–¥–µ–Ω–∏–º\",\n    \"—Ç—Ä–∏–∫–æ—Ç–∞–∂–Ω—ã–π\", \"—Ç—Ä–∏–∫–æ—Ç–∞–∂–Ω–∞—è\", \"—Ç—Ä–∏–∫–æ—Ç–∞–∂\",\n    \"–ª—å–Ω—è–Ω–æ–π\", \"–ª—å–Ω—è–Ω–∞—è\", \"–ª–µ–Ω\", \"–ª—ë–Ω\",\n    \"—à–µ—Ä—Å—Ç—è–Ω–æ–π\", \"—à–µ—Ä—Å—Ç—è–Ω–∞—è\", \"—à–µ—Ä—Å—Ç—å\",\n    \"—Ö–ª–æ–ø–∫–æ–≤—ã–π\", \"—Ö–ª–æ–ø–∫–æ–≤–∞—è\", \"—Ö–ª–æ–ø–æ–∫\",\n    \"–∞—Ç–ª–∞—Å–Ω—ã–π\", \"–∞—Ç–ª–∞—Å–Ω–∞—è\", \"–∞—Ç–ª–∞—Å\",\n    \"—à–µ–ª–∫–æ–≤—ã–π\", \"—à—ë–ª–∫–æ–≤—ã–π\", \"—à–µ–ª–∫–æ–≤–∞—è\", \"—à—ë–ª–∫–æ–≤–∞—è\", \"—à–µ–ª–∫\", \"—à—ë–ª–∫\",\n    \"–±–∞—Ä—Ö–∞—Ç–∏—Å—Ç—ã–π\",\n    # english\n    \"leather\", \"eco leather\", \"faux leather\",\n    \"suede\", \"velvet\", \"denim\", \"knit\", \"linen\", \"wool\", \"cotton\",\n    \"satin\", \"silk\", \"silky\",\n]\n\n\ndef expand_sizes(size_str):\n    \"\"\"\n    –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã:\n    '38-40' -> [38, 39, 40]\n    '38, 40/42' -> [38, 40, 42]\n    \"\"\"\n    size_str = size_str.replace(\" \", \"\")\n    result = set()\n\n    for part in re.split(r\"[,/]\", size_str):\n        if \"-\" in part:\n            start, end = part.split(\"-\", 1)\n            if start.isdigit() and end.isdigit():\n                for num in range(int(start), int(end) + 1):\n                    result.add(num)\n        else:\n            if part.isdigit():\n                result.add(int(part))\n\n    return sorted(result)\n\n\ndef expand_letter_sizes_range(start_size, end_size):\n    \"\"\"\n    –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω –±—É–∫–≤–µ–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤:\n    'S', 'XL' -> ['S', 'M', 'L', 'XL']\n    \"\"\"\n    start_size = start_size.upper()\n    end_size = end_size.upper()\n\n    if start_size not in LETTER_ORDER or end_size not in LETTER_ORDER:\n        # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π ‚Äî –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ\n        return [start_size] if start_size in LETTER_ORDER else []\n\n    i1 = LETTER_ORDER.index(start_size)\n    i2 = LETTER_ORDER.index(end_size)\n\n    if i1 <= i2:\n        return LETTER_ORDER[i1:i2 + 1]\n    else:\n        # –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –¥–∏–∞–ø–∞–∑–æ–Ω —É–∫–∞–∑–∞–Ω –Ω–∞–æ–±–æ—Ä–æ—Ç: XL-S\n        return LETTER_ORDER[i2:i1 + 1]\n\n\ndef clean_price_int(value):\n    \"\"\"\n    –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Ü–µ–Ω—ã –≤ int (15900 –∏–∑ '15.900‚ÇΩ' / '15 900 —Ä—É–±.')\n    \"\"\"\n    if not value:\n        return None\n\n    value = value.replace(\" \", \"\")\n    value = value.replace(\".\", \"\").replace(\",\", \"\")\n    value = re.sub(r\"[^\\d]\", \"\", value)\n\n    if value == \"\":\n        return None\n\n    return int(value)\n\n\ndef extract_colour(text):\n    \"\"\"\n    –ò—â–µ—Ç –≤ —Å—Ç—Ä–æ–∫–µ —Ü–≤–µ—Ç/—Ç–∏–ø (–∫–æ–∂–∞–Ω—ã–π, –±–∞—Ä—Ö–∞—Ç–Ω—ã–π –∏ —Ç.–ø.).\n    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞ '—á–µ—Ä–Ω—ã–π, –∫–æ–∂–∞–Ω—ã–π' –∏–ª–∏ None.\n    \"\"\"\n    if not text:\n        return None\n\n    t = text.lower()\n    found = []\n    seen = set()\n\n    # —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏/–¥–µ—Ñ–∏—Å–∞–º–∏)\n    composite_keywords = [\n        k for k in COLOUR_KEYWORDS + TYPE_KEYWORDS if \" \" in k or \"-\" in k\n    ]\n    simple_keywords = [\n        k for k in COLOUR_KEYWORDS + TYPE_KEYWORDS if \" \" not in k and \"-\" not in k\n    ]\n\n    # —Å–æ—Å—Ç–∞–≤–Ω—ã–µ ‚Äî –ø–æ –≤—Ö–æ–∂–¥–µ–Ω–∏—é –ø–æ–¥—Å—Ç—Ä–æ–∫–∏\n    for k in composite_keywords:\n        if k in t and k not in seen:\n            seen.add(k)\n            found.append(k)\n\n    # –ø—Ä–æ—Å—Ç—ã–µ ‚Äî –ø–æ —Å–ª–æ–≤–∞–º\n    for k in simple_keywords:\n        if re.search(r\"\\b\" + re.escape(k) + r\"\\b\", t) and k not in seen:\n            seen.add(k)\n            found.append(k)\n\n    if not found:\n        return None\n\n    # –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ —Å–ø–∏—Å–æ–∫, –Ω–æ —É–¥–æ–±–Ω–µ–µ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É\n    return \", \".join(found)\n\n\ndef parse_caption(text):\n    result_items = []\n\n    # 0. –£–±–∏—Ä–∞–µ–º —Ö–≤–æ—Å—Ç —Å –ø—Ä–∏–∑—ã–≤–æ–º –∫ –¥–µ–π—Å—Ç–≤–∏—é, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Ç–æ–≤–∞—Ä—É\n    text = re.sub(r\"üì©.*$\", \"\", text, flags=re.S)\n    if \"Aleor_offline\" in text:\n        text = text.split(\"Aleor_offline\", 1)[0]\n\n    # –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –±–ª–æ–∫–∏ –ø–æ 5-–∑–Ω–∞—á–Ω–æ–º—É –Ω–æ–º–µ—Ä—É\n    product_blocks = re.findall(\n        r\"(\\d{5}.*?)(?=(?:\\d{5}\\s)|$)\",\n        text,\n        flags=re.S,\n    )\n\n    price_pattern = r\"(\\d[\\d.,]*\\s*(?:‚ÇΩ|RUB))\"\n\n    for block in product_blocks:\n        raw_line = \" \".join(block.split())\n\n        m_num = re.match(r\"(\\d{5})(?:\\s+(.*))?$\", raw_line)\n        if not m_num:\n            continue\n\n        base_number = m_num.group(1)       # —Å—Ç—Ä–æ–∫–∞ '00003'\n        rest = (m_num.group(2) or \"\").strip()\n\n        # –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–æ–º–µ—Ä –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è\n        if not rest:\n            result_items.append({\n                \"product_number\": base_number,\n                \"product_name\": \"\",\n                \"variant\": \"\",\n                \"size\": None,\n                \"price_new\": None,\n                \"price_old\": None,\n                \"raw_line\": raw_line,\n                \"colour\": None,\n            })\n            continue\n\n        # --- –¶–ï–ù–´ ---\n        all_prices = re.findall(price_pattern, raw_line)\n        price_new = None\n        price_old = None\n\n        if all_prices:\n            # –ü–µ—Ä–≤–∞—è —Ü–µ–Ω–∞ ‚Äî –Ω–æ–≤–∞—è, –ø–æ—Å–ª–µ–¥–Ω—è—è ‚Äî —Å—Ç–∞—Ä–∞—è (–µ—Å–ª–∏ –µ—Å—Ç—å)\n            price_new = clean_price_int(all_prices[0])\n            if len(all_prices) > 1:\n                price_old = clean_price_int(all_prices[-1])\n\n        # --- –†–ê–ó–ú–ï–†–´ ---\n        sizes_list = []\n        size_type = None  # \"eu\" –∏–ª–∏ \"letter\"\n\n        # 1) –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–∏—Å–ª–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Å EU\n        m_eu = re.search(r\"([\\d\\s,\\/\\-]+)\\s*EU\", raw_line)\n        if m_eu:\n            eu_sizes = expand_sizes(m_eu.group(1))\n            if eu_sizes:\n                sizes_list = eu_sizes\n                size_type = \"eu\"\n        else:\n            # 2) –ü—Ä–æ–±—É–µ–º –±—É–∫–≤–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã XXS‚ÄìXXL\n            m_letter = re.search(\n                r\"\\b(XXS|XS|S|M|L|XL|XXL)(?:\\s*-\\s*(XXS|XS|S|M|L|XL|XXL))?\\b\",\n                raw_line,\n                flags=re.I,\n            )\n            if m_letter:\n                s1 = m_letter.group(1).upper()\n                s2 = m_letter.group(2).upper() if m_letter.group(2) else None\n                size_type = \"letter\"\n\n                if s2:\n                    sizes_list = expand_letter_sizes_range(s1, s2)\n                else:\n                    sizes_list = [s1]\n\n        # m_letter –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–∞–ª—å—à–µ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞:\n        m_letter = locals().get(\"m_letter\", None)\n\n        # --- –ù–ê–ó–í–ê–ù–ò–ï –¢–û–í–ê–†–ê (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –∫–∞–∫ fallback) ---\n        num_end = m_num.end(1)  # –ø–æ–∑–∏—Ü–∏—è –∫–æ–Ω—Ü–∞ –Ω–æ–º–µ—Ä–∞\n        first_price_match = re.search(price_pattern, raw_line)\n\n        brand_cut_index = len(raw_line)\n\n        if first_price_match:\n            brand_cut_index = min(brand_cut_index, first_price_match.start())\n        if m_eu:\n            brand_cut_index = min(brand_cut_index, m_eu.start())\n        if m_letter:\n            brand_cut_index = min(brand_cut_index, m_letter.start())\n\n        product_name_old = raw_line[num_end:brand_cut_index].strip(\" ,\")\n        if not product_name_old and rest:\n            product_name_old = rest\n\n        # --- –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê –ë–†–ï–ù–î–ê (–° –£–ß–Å–¢–û–ú –†–ê–ó–ú–ï–†–û–í) ---\n        after_number_words = rest.split()\n        brand_words = []\n\n        for i, word in enumerate(after_number_words):\n            w = word.strip(\",.()\").upper()\n\n            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã (XXS‚ÄìXXL, S/M, L/XL –∏ —Ç.–ø.)\n            if w in LETTER_ORDER:\n                continue\n            if re.fullmatch(r\"(XXS|XS|S|M|L|XL|XXL)(/(XXS|XS|S|M|L|XL|XXL))?\", w):\n                continue\n\n            # –ò—â–µ–º –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ —Å –ª–∞—Ç–∏–Ω–∏—Ü–µ–π\n            if re.search(r\"[A-Za-z]\", word):\n                brand_words.append(word)\n\n                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ ‚Äî –µ—Å–ª–∏ –æ–Ω–æ —Ç–æ–∂–µ –ª–∞—Ç–∏–Ω–∏—Ü–∞ –∏ –Ω–µ —Ä–∞–∑–º–µ—Ä\n                if i + 1 < len(after_number_words):\n                    next_word = after_number_words[i + 1]\n                    next_w = next_word.strip(\",.()\").upper()\n\n                    if (re.search(r\"[A-Za-z]\", next_word) and\n                        next_w not in LETTER_ORDER and\n                        not re.fullmatch(r\"(XXS|XS|S|M|L|XL|XXL)(/(XXS|XS|S|M|L|XL|XXL))?\", next_w)):\n                        brand_words.append(next_word)\n\n                break\n\n        brand = \" \".join(brand_words).strip(\" ,\")\n\n        if brand:\n            product_name = brand\n        else:\n            # –µ—Å–ª–∏ –±—Ä–µ–Ω–¥–∞ –ø–æ –ª–∞—Ç–∏–Ω–∏—Ü–µ –Ω–µ –Ω–∞—à–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É\n            product_name = product_name_old\n\n        variant = \"\"\n\n        # --- –¶–í–ï–¢ / –¢–ò–ü ---\n        colour = extract_colour(raw_line)\n\n        # --- –°–û–ó–î–ê–Å–ú ITEMS ---\n        if not sizes_list:\n            result_items.append({\n                \"product_number\": base_number,\n                \"product_name\": product_name,\n                \"variant\": variant,\n                \"size\": None,\n                \"price_new\": price_new,\n                \"price_old\": price_old,\n                \"raw_line\": raw_line,\n                \"colour\": colour,\n            })\n        else:\n            for s in sizes_list:\n                if size_type == \"eu\":\n                    size_value = str(s)\n                else:\n                    size_value = s  # 'XS', 'S', 'M', 'L', 'XL', ...\n\n                result_items.append({\n                    \"product_number\": base_number,\n                    \"product_name\": product_name,\n                    \"variant\": variant,\n                    \"size\": size_value,\n                    \"price_new\": price_new,\n                    \"price_old\": price_old,\n                    \"raw_line\": raw_line,\n                    \"colour\": colour,\n                })\n\n    # --- –°–æ–∑–¥–∞—ë–º id_item –ø–æ product_number ---\n    base_to_id = {}\n    current_id = 1\n\n    for item in result_items:\n        pn = item[\"product_number\"]\n        if pn not in base_to_id:\n            base_to_id[pn] = current_id\n            current_id += 1\n        item[\"id_item\"] = base_to_id[pn]\n\n    return {\"items\": result_items}\n\n\n# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–µ—Ä –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è n8n\nparsed = parse_caption(caption)\n\nreturn [{\n    \"json\": parsed\n}]\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        128
      ],
      "id": "3dd075b3-1f0e-42b1-89e2-09a4ebf7890b",
      "name": "Code in Python (Beta)1"
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "s5bCtn0uH8aHs8Ol",
          "mode": "list",
          "cachedResultName": "TelegramAlbumBuffer",
          "cachedResultUrl": "/projects/X1POyEYy8ekNc4Iq/datatables/s5bCtn0uH8aHs8Ol"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "media_group_id",
              "displayName": "media_group_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "message_id",
              "displayName": "message_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "file_id",
              "displayName": "file_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "caption",
              "displayName": "caption",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -160,
        368
      ],
      "id": "01ededa7-f326-4ebf-9adb-a73629085972",
      "name": "Saving"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "21b191c0-db8b-47cf-b9ce-dcd26226cf2c",
              "leftValue": "={{ $json.channel_post.media_group_id }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -336,
        560
      ],
      "id": "673c8315-e5b9-46f1-8f42-231d6c4c8581",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "21b191c0-db8b-47cf-b9ce-dcd26226cf2c",
              "leftValue": "={{ $json.caption }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -16,
        240
      ],
      "id": "540964d1-8584-4d8e-bfaf-82edd61c49e7",
      "name": "If2"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "zF7GH0wSQFf9RjNG",
          "mode": "list",
          "cachedResultName": "TelegramAlbumBuffer",
          "cachedResultUrl": "/projects/J79gBJLVPPntD8dp/datatables/zF7GH0wSQFf9RjNG"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "media_group_id",
              "keyValue": "={{ $json.media_group_id }}"
            },
            {}
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        384,
        432
      ],
      "id": "d7a32e71-59b8-446f-b91c-1e3a96fc0ffb",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "fieldToSplitOut": "=items",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        944,
        128
      ],
      "id": "de4d575e-9f85-45a8-961f-8ff8fd3296f6",
      "name": "Split Out"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "zF7GH0wSQFf9RjNG",
          "mode": "list",
          "cachedResultName": "TelegramAlbumBuffer",
          "cachedResultUrl": "/projects/J79gBJLVPPntD8dp/datatables/zF7GH0wSQFf9RjNG"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "media_group_id",
              "keyValue": "={{ $json.media_group_id }}"
            },
            {
              "keyName": "caption",
              "condition": "isNotEmpty"
            }
          ]
        },
        "returnAll": true
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        576,
        96
      ],
      "id": "db690ddb-b782-457f-9e6c-7509406977d0",
      "name": "Get row(s)1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "fotos",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        816,
        432
      ],
      "id": "68f94a8c-6409-428a-92da-5fc5e7939c10",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "mode": "combine",
        "advanced": true,
        "mergeByFields": {
          "values": [
            {
              "field1": "items.id_item",
              "field2": "fotos.id_fotos"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1120,
        352
      ],
      "id": "d2b04609-e781-446c-aab0-e4a25b913b12",
      "name": "Merge1"
    },
    {
      "parameters": {
        "operation": "deleteRows",
        "dataTableId": {
          "__rl": true,
          "value": "zF7GH0wSQFf9RjNG",
          "mode": "list",
          "cachedResultName": "TelegramAlbumBuffer",
          "cachedResultUrl": "/projects/J79gBJLVPPntD8dp/datatables/zF7GH0wSQFf9RjNG"
        },
        "filters": {
          "conditions": [
            {
              "condition": "isNotEmpty"
            }
          ]
        },
        "options": {
          "dryRun": false
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1728,
        480
      ],
      "id": "1f4f3044-1e15-4589-ab30-dd5f34a355ba",
      "name": "Delete row(s)"
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "appQu6xEHi6aHAuDM",
          "mode": "list",
          "cachedResultName": "Product Catalog",
          "cachedResultUrl": "https://airtable.com/appQu6xEHi6aHAuDM"
        },
        "table": {
          "__rl": true,
          "value": "tblbMlEHH6iZ0D0na",
          "mode": "list",
          "cachedResultName": "Products",
          "cachedResultUrl": "https://airtable.com/appQu6xEHi6aHAuDM/tblbMlEHH6iZ0D0na"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Product Photo": "={{ $json.product_photo }}",
            "product_number": "={{ $json.items.product_number }}",
            "Size": "={{ $json.items.size }}",
            "Price": "={{ $json.items.price_new }}",
            "Brand": "={{ $json.items.product_name }}",
            "Colour": "={{ $json.items.colour }}",
            "Description": "={{ $json.items.raw_line }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "product_number",
              "displayName": "product_number",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "Brand",
              "displayName": "Brand",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Product Category (AI)",
              "displayName": "Product Category (AI)",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Description",
              "displayName": "Description",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Product Photo",
              "displayName": "Product Photo",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "array",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Post URL",
              "displayName": "Post URL",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Stock",
              "displayName": "Stock",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Size",
              "displayName": "Size",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Price",
              "displayName": "Price",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Colour",
              "displayName": "Colour",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Created At",
              "displayName": "Created At",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Updated At",
              "displayName": "Updated At",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "dateTime",
              "readOnly": false,
              "removed": true
            },
            {
              "id": "Days Since Update",
              "displayName": "Days Since Update",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "typecast": true
        }
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1984,
        112
      ],
      "id": "a6a32f1e-cf6e-4fdb-b9ad-83e4837493f3",
      "name": "Create a record",
      "credentials": {
        "airtableTokenApi": {
          "id": "SUvXYEflYEOLFKD6",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.fotos.file_id }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1440,
        32
      ],
      "id": "3cfdbcfc-c2ff-4524-b7a1-967b36d07e88",
      "name": "Get a file",
      "webhookId": "5241f09c-8622-45dd-b5d1-d4c6042dce9e",
      "credentials": {
        "telegramApi": {
          "id": "tiy2v3e2GBz9Q8oz",
          "name": "Aleor bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Function / Code node\n\n// –ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é (–∏–ª–∏ –≤–∑—è—Ç—å –∏–∑ $env, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å)\nconst BOT_TOKEN = '8118258878:AAHqnLvF2NzMBqP11exKwFf8jXM2DpU4hQI';\n\nreturn items.map(item => {\n  const filePath = item.json.result?.file_path;\n\n  // –ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ—Ç file_path ‚Äî —á—Ç–æ–±—ã –Ω–æ–¥–∞ –Ω–µ –ø–∞–¥–∞–ª–∞\n  const product_photo = filePath\n    ? [\n        {\n          url: `https://api.telegram.org/file/bot${BOT_TOKEN}/${filePath}`\n        }\n      ]\n    : [];\n\n  return {\n    json: {\n      ...item.json,\n      product_photo,\n    }\n  };\n});\n\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1632,
        32
      ],
      "id": "2cb7522b-2d16-4ba3-8d3e-ceafde65bd39",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1824,
        112
      ],
      "id": "f395a0fd-8908-4285-9dd0-c96869c23cd6",
      "name": "Merge"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        192,
        -48
      ],
      "id": "20cc04b3-8b72-449e-b313-82c8c7b180a3",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f4e60f08-4540-4b2d-9644-350bd22cd9d0",
              "leftValue": "={{ $json.caption }}",
              "rightValue": "Aleor_offline",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        176,
        144
      ],
      "id": "10d196a8-08b1-4366-b37b-f2bdab47414a",
      "name": "If1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        48,
        816
      ],
      "id": "1392b5f6-21f9-4b95-8701-417d464bed36",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "content": "##  –î–æ–¥–µ–ª–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –µ–¥–∏–Ω–∏—á–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞\n\n",
        "height": 352,
        "width": 448
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -80,
        688
      ],
      "id": "d46f6ac1-e95e-4d0f-bd79-a138d577f84c",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "chatId": "=976192165",
        "text": "‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–Ω–µ—Å–µ–Ω—ã –≤ –±–∞–∑—É!",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1568,
        480
      ],
      "id": "d829c154-6802-48c1-b26b-d4a7f832b3d5",
      "name": "Send a text message",
      "webhookId": "1e5889f3-09f0-4ce7-930c-77cefef8b395",
      "credentials": {
        "telegramApi": {
          "id": "tiy2v3e2GBz9Q8oz",
          "name": "Aleor bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0e27ae08-9888-4cf3-a607-b9b168389538",
                    "leftValue": "={{ $json.items.id_item }}",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1392,
        480
      ],
      "id": "00099282-65d7-4602-b3e1-df4747a95ac5",
      "name": "Switch"
    },
    {
      "parameters": {
        "content": "##  –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?\n\n###  1. –ü–æ–º–µ–Ω—è—Ç—å –±–æ—Ç–∞ –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –í–∞–Ω–µ. \n###  2. –ü–æ–º–µ–Ω—è—Ç—å –±–∞–∑—É Airtable. \n###  3. –î–æ–±–∞–≤–∏—Ç—å 1 –±–æ—Ç–∞ –≤ —á–∞—Ç –∞ –¥—Ä—É–≥–æ–≥–æ –≤ —á–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.\n ",
        "height": 352,
        "width": 448
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1248,
        832
      ],
      "id": "0e875675-17ff-47b9-b129-14cc8776caa7",
      "name": "Sticky Note1"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get row(s)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Saving": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Saving",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)1": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Get a file",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          },
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a file": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Create a record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Delete row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "446ed34f-17d7-47fc-90dd-0519276f4241",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "14b42ef11fb9a07361aa8afa022fcc0191c5c361f93e1b8491f63d1f46deadb3"
  },
  "id": "YEsvKH9iChKxgA13",
  "tags": []
}